---
import Layout from '../layouts/Layout.astro';
---

<Layout> test </Layout>

<script>
	const urlParams = new URLSearchParams(window.location.search);
	const playlistID = urlParams.get('id');
	if (!playlistID) {
		alert('Need playlistID');
		window.location.href = '/';
	}
	const accessToken = localStorage.getItem('access_token') || null;
	if (!accessToken) {
		alert('Please authenticate first.');
		window.localStorage.removeItem('access_token');
	}
	const url = 'https://api.spotify.com/v1/me/playlists?limit=20&offset=0';
	const response = await fetch(url, {
		headers: {
			Authorization: 'Bearer ' + accessToken,
		},
	});

	const data: {
		href: string;
		limit: number;
		next: string | null;
		offset: number;
		previous: string | null;
		total: number;
		items: Array<{
			collaborative: boolean;
			description: string | null;
			external_urls: {
				spotify: string;
			};
			href: string;
			id: string;
			images: Array<{
				height: number | null;
				url: string;
				width: number | null;
			}>;
			name: string;
			owner: {
				display_name: string | null;
				external_urls: {
					spotify: string;
				};
				href: string;
				id: string;
				type: string;
				uri: string;
			};
			public: boolean;
			snapshot_id: string;
			tracks: {
				href: string;
				total: number;
			};
			type: string;
			uri: string;
		}>;
	} = await response.json();

	if (!response.ok) {
		alert('Failed to fetch playlists: ');
		localStorage.removeItem('access_token');
		window.location.href = '/';
	}
	console.log(data);
</script>
